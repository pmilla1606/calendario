var AppointmentModel=Backbone.Model.extend({defaults:{dateDay:"",dateMonth:"",dateYear:"",display_year:"",display_month:"",display_day:"",time_start:"",time_display:"",service:"",client_name:"",client_phone:"",client_email:"",client_comments:"",admin_comments:"",app_id:""}});Date.prototype.addDays=function(e){return this.setDate(this.getDate()+e),this},Date.prototype.subDays=function(e){return this.setDate(this.getDate()-e),this};var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],InfoView=Backbone.View.extend({el:"#name",events:{"click .appProceed":"datesView"},initialize:function(){this.datesView()},render:function(){},datesView:function(){var e=$("#client_name").val(),t=$("#client_phone").val(),a=$("#client_email").val(),n=$("#service_type").val();appointment.set({service:n,client_name:e,client_phone:t,client_email:a});var i=new CalendarView}}),CalendarView=Backbone.View.extend({el:"#calendar",events:{"click .dayCell":"newEntry","click .prevMonth":"prevMonth","click .nextMonth":"nextMonth","keyup #client_name":"typeFunction","change #service_type":"serviceFunction"},serviceFunction:function(e){var t=$(e.target).val();appointment.set({service:t})},typeFunction:function(e){var t=$(e.target).val();appointment.set({client_name:t})},initialize:function(){var e=moment(),t=e.format("D"),a=e.format("M"),n=e.format("YYYY");appointment.set({dateMonth:Number(a-1),dateYear:Number(n),dateDay:Number(t),display_day:e.format("dddd"),display_month:e.format("MMMM"),display_year:Number(n),display_date:Number(t)}),this.renderCalendar(),appointment.on("change:dateMonth",this.renderCalendar,this)},renderCalendar:function(){var e=this,t=moment({YYYY:appointment.get("dateYear"),M:Number(appointment.get("dateMonth")),D:appointment.get("dateDay")}),a=Number(t.format("YYYY")),n=Number(t.format("M")-1),o=Number(t.format("D")),s=t.daysInMonth(),r=moment({YYYY:a,M:n,D:1}),m=r.days(),p=_.template($("#temp_active_days").html()),d=moment().format("D");for(console.log(r),e.$el.html(""),e.$el.prepend('<span class="prevMonth">Prev Month</span><span class="nextMonth">Next Month</span>'),i=0;i<dayNames.length;i++)e.$el.append('<div class="day-header" data-dayHeader="'+i+'">'+dayNames[i]+"</div>");for(i=0;m>i;i++)e.$el.append('<div class="dayCell blank"></div>');for(i=0;s>i;i++)e.$el.append(p({day_number:i+1}));e.$el.append('<div class="cf"></div>'),e.$el.fadeIn("fast")},nextMonth:function(){var e=Number(appointment.get("dateMonth")+1);appointment.set({dateMonth:Number(e)})},prevMonth:function(){var e=Number(appointment.get("dateMonth")-1);appointment.set({dateMonth:Number(e)})},newEntry:function(e){var t=this,a=$(e.target),n=$(e.target).data("day");if($(e.target).hasClass("blank"))return!1;$(e.target).addClass("selected").siblings().removeClass("selected"),appointment.set({dateDay:Number(n)});var i=appointment.get("dateDay"),o=appointment.get("dateMonth"),s=appointment.get("dateYear"),r=moment({YYYY:s,M:o,D:i}),m=new DetailsView({model:appointment});t.$el.fadeOut("fast")}}),DetailsView=Backbone.View.extend({el:"#details",events:{"click .closeMe":"closeView","click .bookNowBtn":"selectTime"},template:_.template($("#temp_time_select").html()),initialize:function(){var e=moment().set("D",Number(appointment.get("dateDay"))),t=moment().set("M",Number(appointment.get("dateMonth"))),t=moment().set("YYYY",Number(appointment.get("dateYear")));appointment.set({display_day:e.format("dddd"),display_month:t.format("MMMM"),display_year:appointment.get("dateYear"),display_date:appointment.get("dateDay")}),appointment.on("change",this.render,this),this.render()},render:function(){this.$el.fadeIn("fast").html(this.template(this.model.toJSON())),this.fetchAvail()},fetchAvail:function(){var e=_.template($("#temp_available_time_button").html()),t=[800,900,1200,1300,1400,1500],a=["8:00am","9:00am","12:00pm","1:00pm","2:00pm","3:00pm"];for(i=0;i<t.length;i++)this.$el.find(".availableTimesWrap").append(e({time_slot:t[i],time_slot_display:a[i]}))},selectTime:function(e){$.fn.animateRotate=function(e,t,a,n){return this.each(function(){var i=$(this);$({deg:0}).animate({deg:e},{duration:t,easing:a,step:function(e){i.css({transform:"rotate("+e+"deg)"})},complete:n||$.noop})})};var t=$(e.target);appointment.set({time_start:e.target.attributes[2].value,time_display:e.target.innerText}),this.$el.find("#hour").animateRotate(appointment.get("time_start"),1e3),this.$el.find("#minute").animateRotate(270,1250),this.serviceType()},serviceType:function(){var e=_.template($("#temp_service_type").html());appointment.set({service:"sample service"}),this.$el.find(".availableTimesWrap").fadeIn("fast").append(e(this.model.toJSON()))},closeView:function(e){e.preventDefault(),appointment.set({time_display:""}),this.$el.fadeOut("fast"),this.undelegateEvents(),this.$el.removeData().unbind()}}),StepsView=Backbone.View.extend({el:"#steps",template:_.template($("#temp_steps").html()),initialize:function(){appointment.on("change:dateDay",this.render,this)},render:function(){this.$el.html(this.template(this.model.toJSON()))}}),App=Backbone.View.extend({initialize:function(){this.render()},render:function(){var e=new InfoView}});$(document).ready(function(){$("#start_booking").on("click",function(){$("#booking-engine").fadeIn("fast"),$("body").addClass("stop-scrolling")}),$("#close_booking").on("click",function(){$("#booking-engine").fadeOut("fast"),$("body").removeClass("stop-scrolling")}),appointment=new AppointmentModel,app=new App});